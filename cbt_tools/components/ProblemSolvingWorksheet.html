<div style="max-width: 700px; margin: 0 auto;">
    <h4 style="text-align: center; font-size: 1.8em; margin-bottom: 10px;">üß© Problem-Solving Worksheet</h4>
    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">Work through a current problem step-by-step with a structured approach</p>

    <form id="problemSolvingForm">
        <!-- Before Mood -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 15px; display: block; text-align: center;">How are you feeling right now?</label>
            <div id="problemSolvingMoodBefore"></div>
        </div>

        <!-- Problem Description -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">Describe the problem ü§î</label>
            <textarea name="problem" required rows="3" style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--bg-input); color: var(--text-primary); font-size: 1em;" placeholder="What challenge are you facing?"></textarea>
        </div>

        <!-- Possible Solutions -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">List possible solutions üí°</label>
            <textarea name="solutions" rows="4" style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--bg-input); color: var(--text-primary); font-size: 1em;" placeholder="Separate each solution with a new line&#10;&#10;1. Solution one...&#10;2. Solution two..."></textarea>
        </div>

        <!-- Chosen Solution -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">Best solution to try first ‚≠ê</label>
            <input type="text" name="chosen_solution" style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--bg-input); color: var(--text-primary); font-size: 1.1em;" placeholder="Which solution feels most promising?">
        </div>

        <!-- Action Plan -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">Action plan (next step) üéØ</label>
            <input type="text" name="action_plan" style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--bg-input); color: var(--text-primary); font-size: 1.1em;" placeholder="What is the very first step you will take?">
        </div>

        <!-- After Mood -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label style="font-weight: 600; margin-bottom: 15px; display: block; text-align: center;">How do you feel after making this plan? üåü</label>
            <div id="problemSolvingMoodAfter"></div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 12px;">
            <button type="button" class="btn btn-secondary" onclick="resetProblemSolving()" style="flex: 1;">üîÑ Reset</button>
            <button type="button" class="btn" onclick="saveProblemSolving()" style="flex: 2; background: var(--success-color); font-size: 1.1em;">üíæ Save Plan</button>
        </div>
    </form>
    <div id="problemSolvingStatus"></div>
</div>

<script>
function saveProblemSolving() {
    saveCBTToolData('ProblemSolvingWorksheet');
}

function resetProblemSolving() {
    document.getElementById('problemSolvingForm').reset();
    const beforeBtns = document.querySelectorAll('#problemSolvingMoodBefore .emoji-mood-btn');
    const afterBtns = document.querySelectorAll('#problemSolvingMoodAfter .emoji-mood-btn');
    beforeBtns.forEach(btn => btn.classList.remove('selected'));
    afterBtns.forEach(btn => btn.classList.remove('selected'));
}

// Initialize mood selectors
setTimeout(() => {
    if (document.getElementById('problemSolvingMoodBefore') && !document.querySelector('#problemSolvingMoodBefore .emoji-mood-selector')) {
        createEmojiMoodSelector('problemSolvingMoodBefore');
        const beforeInput = document.getElementById('problemSolvingMoodBefore_value');
        if (beforeInput) beforeInput.name = 'mood_before_value';
    }
    if (document.getElementById('problemSolvingMoodAfter') && !document.querySelector('#problemSolvingMoodAfter .emoji-mood-selector')) {
        createEmojiMoodSelector('problemSolvingMoodAfter');
        const afterInput = document.getElementById('problemSolvingMoodAfter_value');
        if (afterInput) afterInput.name = 'mood_rating';
    }
}, 100);
</script>
